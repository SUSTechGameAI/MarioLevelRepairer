# A Novel CNet-assisted Evolutionary Level Repairer  

Applying latent variable evolution to game level design has become more and more popular as little human expert knowledge is required. However, defective levels with illegal
patterns may be generated due to the violation of constraints forlevel design. A traditional way of repairing the defective levelsis programming specific rule-based repairers to patch the flaw.
However, programming these constraints is sometimes complex and not straightforward. An autonomous level repairer which is capable of learning the constraints is needed. In this project, we use a novel approach, CNet, to learn the probability distribution of tiles giving its surrounding tiles on a set of real levels, and then detect the illegal tiles in generated new levels. Then, an evolutionary repairer is designed to search for optimal replacement schemes equipped with a novel search space being constructed with the help of CNet and a novel heuristic function. The proposed approaches are proved to be effective in our case study of repairing GAN-generated and artificially destroyed levels of Super Mario Bros. game. Our CNet-assisted evolutionary repairer can also be easily applied to other games of which the levels can be represented by a matrix of objects or tiles.  

For more information, please see the following publication. This publication should also be cited if code from this project is used in any way:

```
@article{shu2020novel,
  title={A Novel CNet-assisted Evolutionary Level Repairer and Its Applications to Super Mario Bros},
  author={Shu, Tianye and Wang, Ziqi and Liu, Jialin and Yao, Xin},
  journal={arXiv preprint arXiv:2005.06148},
  year={2020}
}
```

### Requirement

python3、pytorch、pygame

### How to use

##### CNet folder:

you can run data/generate.py to generate train and test data. "model.py" is for train and "test.py" if for test.

##### LevelGenerator folder:

1. you can run "GAN/generate_level.py" to get levels generated by GAN and  pick up some levels with defect.
2. you can run "RandomDestroyed/generate.py" to get random destroyed levels.

##### GA folder:

1. run "run.py" to reapir defective levels . And reuslts will be saved. (save figure will slow the speed.)
2. run "render.py" to visualize the repair process. "space" to stop playing. When you  stop playing, you can use "left arrow" and "right arrow" to control.
3. run "draw_graph.py" to draw the graph from repair results.
4. run "evaluate.py" to see how many true(wrong) tiles was changed to true(wrong) tiles after repair.
5. when you start a new repair, you can run "clear.py" to clear the old result.
